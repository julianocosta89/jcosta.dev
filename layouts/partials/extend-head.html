{{/* Consent Banner Styles */}}
<style>
  .consent-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(10px);
    color: #fff;
    padding: 1.5rem;
    z-index: 9999;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    display: none;
  }

  .consent-banner.show {
    display: block;
  }

  .consent-banner-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .consent-banner-text {
    flex: 1;
    min-width: 250px;
  }

  .consent-banner-text p {
    margin: 0;
    font-size: 0.95rem;
    line-height: 1.5;
  }

  .consent-banner-text a {
    color: #3b82f6;
    text-decoration: underline;
  }

  .consent-banner-buttons {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .consent-banner-btn {
    padding: 0.625rem 1.25rem;
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 500;
    transition: all 0.2s;
  }

  .consent-banner-btn-accept {
    background: #3b82f6;
    color: white;
  }

  .consent-banner-btn-accept:hover {
    background: #2563eb;
  }

  .consent-banner-btn-decline {
    background: transparent;
    color: #9ca3af;
    border: 1px solid #4b5563;
  }

  .consent-banner-btn-decline:hover {
    background: rgba(255, 255, 255, 0.05);
    color: #fff;
  }

  @media (max-width: 768px) {
    .consent-banner-content {
      flex-direction: column;
      align-items: stretch;
    }

    .consent-banner-buttons {
      width: 100%;
    }

    .consent-banner-btn {
      flex: 1;
    }
  }
</style>

{{/* Datadog RUM - Loaded but not initialized yet */}}
<script
    src="https://www.datadoghq-browser-agent.com/eu1/v6/datadog-rum.js"
    type="text/javascript">
</script>

{{/* Consent Management and Conditional Datadog RUM Initialization */}}
<script>
  (function() {
    const CONSENT_KEY = 'jcosta-analytics-consent';
    const CONSENT_VERSION = '1';

    // Function to initialize Datadog RUM
    function initDatadogRUM() {
      if (window.DD_RUM) {
        window.DD_RUM.init({
          clientToken: 'pubab09ff8a7fee0682485eec0e2f2034cc',
          applicationId: 'b6d9da4a-109a-4a3d-b34c-9db935401a61',
          site: 'datadoghq.eu',
          service: 'jcosta.dev',
          env: 'prod',
          sessionSampleRate: 100,
          sessionReplaySampleRate: 10,
          trackBfcacheViews: true,
          defaultPrivacyLevel: 'mask-user-input',
        });
        console.log('Datadog RUM initialized');
      }
    }

    // Check for existing consent
    function getConsent() {
      try {
        const stored = localStorage.getItem(CONSENT_KEY);
        if (stored) {
          const data = JSON.parse(stored);
          if (data.version === CONSENT_VERSION) {
            return data.consent;
          }
        }
      } catch (e) {
        console.error('Error reading consent:', e);
      }
      return null;
    }

    // Save consent choice
    function saveConsent(accepted) {
      try {
        localStorage.setItem(CONSENT_KEY, JSON.stringify({
          consent: accepted,
          version: CONSENT_VERSION,
          timestamp: new Date().toISOString()
        }));
      } catch (e) {
        console.error('Error saving consent:', e);
      }
    }

    // Show consent banner
    function showBanner() {
      const banner = document.getElementById('consent-banner');
      if (banner) {
        banner.classList.add('show');
      }
    }

    // Hide consent banner
    function hideBanner() {
      const banner = document.getElementById('consent-banner');
      if (banner) {
        banner.classList.remove('show');
      }
    }

    // Handle user choice
    function handleConsent(accepted) {
      saveConsent(accepted);
      hideBanner();

      if (accepted) {
        initDatadogRUM();
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      const consent = getConsent();

      if (consent === true) {
        initDatadogRUM();
      } else if (consent === null) {
        showBanner();
      }

      // Attach event listeners
      const acceptBtn = document.getElementById('consent-accept');
      const declineBtn = document.getElementById('consent-decline');

      if (acceptBtn) {
        acceptBtn.addEventListener('click', function() {
          handleConsent(true);
        });
      }

      if (declineBtn) {
        declineBtn.addEventListener('click', function() {
          handleConsent(false);
        });
      }
    });
  })();
</script>
